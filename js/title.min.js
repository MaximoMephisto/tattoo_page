function loop(){ctx.clearRect(0,0,c.width,c.height);for(var t=0,i=points.length;t<i;t++)points[t].update()}function init(){ctx.beginPath(),ctx.fillStyle="#000",ctx.rect(0,0,c.width,c.height),ctx.fill(),ctx.font=fontStr,ctx.textAlign="left",ctx.fillStyle="#fff",ctx.fillText(str,0,c.height/2+c.height/2),ctx.closePath(),mask=ctx.getImageData(0,0,c.width,c.height),ctx.clearRect(0,0,c.width,c.height);for(var t=0;t<mask.data.length;t+=4)255==mask.data[t]&&255==mask.data[t+1]&&255==mask.data[t+2]&&255==mask.data[t+3]&&whitePixels.push([iToX(t,mask.width),iToY(t,mask.width)]);for(var i=0;i<pointCount;i++)addPoint()}function addPoint(){var t=whitePixels[Math.floor(Math.random()*whitePixels.length)],i=new point(t[0],t[1],Math.floor(2*Math.random()-1),Math.floor(2*Math.random()-1));points.push(i)}function iToX(t,i){return t%(4*i)/4}function iToY(t,i){return Math.floor(t/(4*i))}function coordsToI(t,i,h){return 4*(mask.width*i+t)}var mask,c=document.getElementById("myCanvas"),ctx=c.getContext("2d"),pointCount=2600,str="HALLOMANN",fontStr="bold 128pt Helvetica Neue, Helvetica, Arial, sans-serif";ctx.font=fontStr,ctx.textAlign="center",c.width=ctx.measureText(str).width,c.height=128;var whitePixels=[],points=[],point=function(t,i,h,s){this.x=t,this.y=i,this.vx=h||1,this.vy=s||1};point.prototype.update=function(){ctx.beginPath(),ctx.fillStyle="#160040",ctx.arc(this.x,this.y,1,0,2*Math.PI),ctx.fill(),ctx.closePath(),(this.x+this.vx>=c.width||this.x+this.vx<0||255!=mask.data[coordsToI(this.x+this.vx,this.y,mask.width)])&&(this.vx*=-1,this.x+=2*this.vx),(this.y+this.vy>=c.height||this.y+this.vy<0||255!=mask.data[coordsToI(this.x,this.y+this.vy,mask.width)])&&(this.vy*=-1,this.y+=2*this.vy);for(var t=0,i=points.length;t<i;t++)if(points[t]!==this){var h=Math.sqrt(Math.pow(this.x-points[t].x,2)+Math.pow(this.y-points[t].y,2));h<5&&(ctx.lineWidth=.2,ctx.beginPath(),ctx.moveTo(this.x,this.y),ctx.lineTo(points[t].x,points[t].y),ctx.stroke()),h<20&&(ctx.lineWidth=.1,ctx.beginPath(),ctx.moveTo(this.x,this.y),ctx.lineTo(points[t].x,points[t].y),ctx.stroke())}this.x+=this.vx,this.y+=this.vy},setInterval(loop,50),init();